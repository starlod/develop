server {
    listen <%= node["nginx"]["port"] %>;

    server_name public.dev;
    root  /var/www/html/public;
    index index.php;

    # Load configuration files for the default server block.
    include /etc/nginx/default.d/*.conf;

    ## matches any query, since all queries begin with /
    location / {
        if (!-e $request_filename) {
            rewrite ^/(.*)$ /app_dev.php?q=$1 last;
        }
    }

    location ~ [^/]\.php(/|$) {
        # PATH_INFO 部の分割に使用する正規表現を指定
        # 一つ目 ( .+\.php ) は $fastcgi_script_name の値になり、二つ目 ( /.+ ) は $fastcgi_path_info の値になる
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        if (!-f $document_root$fastcgi_script_name) {
            return 404;
        }

        # FastCGI サーバへリクエストをプロキシする
        fastcgi_pass   unix:/var/run/php-fpm.sock;

        # $fastcgi_script_name の値になる
        fastcgi_index  app_dev.php;

        # 設定ファイルを読み込む
        include        fastcgi_params;

        # FastCGI サーバに渡されるべきパラメータを設定
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
        fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;
    }

    ## disable viewing .htaccess & .htpaswd
    location ~ /\.ht {
        deny all;
    }
}